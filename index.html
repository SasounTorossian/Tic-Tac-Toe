<!DOCTYPE html>
 <html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Etch-a-Sketch</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="styles/style.css">
    </head>
    <body>
        <div class="header">
            <h1 class="projectTitle">Tic-Tac-Toe</h1>
        </div>

        <div class="gameInfo">
            <p></p>
        </div>

        <div class="container" >
        </div>

        <div class="footer">
            <p>A project by Sasoun Torossian. 2020</p>
            <a id="gitLink" href="https://github.com/SasounTorossian">
              <img alt="Github" src="images/Github Logo.png" height="60px"></a>
        </div>

        <script>
            // ===== PLAYER =====
            const Player = (name, mark) => {
                let playerName = name
                let playerMark = mark

                return {
                    playerName,
                    playerMark
                }
            }

            // ===== GAMEENGINE =====
            const gameEngine = (() => {
                let players = []
                let currentPlayer

                const startGame = (player1, player2) => {
                    addPlayers(player1, player2)
                    gameBoard.renderGameboard()
                }

                const addPlayers = (p1, p2) => {
                    players.push(p1)
                    players.push(p2)
                    assignPlayers()
                }

                const assignPlayers = () => currentPlayer = players[0]

                const switchPlayer = () => {
                    currentPlayer = currentPlayer == players[0] ? 
                                    players[1] : players[0]
                }

                const getCurrentPlayer = () => currentPlayer

                return {
                    startGame,
                    switchPlayer,
                    getCurrentPlayer
                }

            })()

            // ===== GAMEBOARD =====
            const gameBoard = (() => {
                let container = document.getElementsByClassName("container")[0]
                let gameBoardArray = new Array(9).fill("")
                const winningCombos = [["0", "1", "2"],
                                        ["3", "4", "5"],
                                        ["6", "7", "8"],
                                        ["0", "3", "6"],
                                        ["1", "4", "7"],
                                        ["2", "5", "8"],
                                        ["0", "4", "8"],
                                        ["2", "4", "6"]]

                const addMark = (e) => {
                    let div = e.target
                    let index = div.getAttribute("index")
                    if(div.innerText != "") return

                    let mark = gameEngine.getCurrentPlayer() == player1 ?
                    player1.playerMark : player2.playerMark

                    gameBoardArray[index] = mark
                    div.innerText = mark

                    gameEngine.switchPlayer()
                    console.log(isGameboardFull())    
                    console.log(isGameboardWin())   
                      
                }

                const renderGameboard = () => {
                    gameBoardArray.forEach(function(element, index) {
                        let div = document.createElement("div")
                        div.classList.add("tile")
                        div.setAttribute("index", index)
                        div.addEventListener('click', addMark)

                        div.innerText = element
                        container.appendChild(div)
                    })
                }

                const isGameboardWin = () => {
                    let player1Win = winningCombos.some(arr => arr.every(el => gameBoardArray[el] == "X"))
                    let player2Win = winningCombos.some(arr => arr.every(el => gameBoardArray[el] == "O"))

                    if (!player1Win && !player2Win) return false
                    return player1Win ? 1 : 2
                }

                const isGameboardFull = () => {
                    return gameBoardArray.indexOf("") == -1 ? true : false
                }

                return {
                    renderGameboard
                }
                })()

                let player1 = Player("Benedict", "X")
                let player2 = Player("Alistair", "O")
                gameEngine.startGame(player1, player2)

        </script>
    </body>
</html>